<div class="dashboard-container">
    <p-toast></p-toast>
    
    <!-- ==================== HEADER ==================== -->
    <h1>锔 Configuraci贸n del Sistema</h1>
    <p class="subtitle">Administra las configuraciones globales del sistema</p>
    
    <!-- ==================== LAYOUT DE 2 COLUMNAS ==================== -->
    <div class="grid">
        
        <!-- ==================== COLUMNA IZQUIERDA ==================== -->
        <div class="col-12 lg:col-6">
            
            <!-- CONFIGURACIN GENERAL (ya existe) -->
            <p-card header="Configuraci贸n General" class="mb-4">
                <div class="form-group">
                    <label class="font-medium text-900 mb-2 block">Nombre del Sistema</label>
                    <input pInputText [(ngModel)]="nombreSistema" (ngModelChange)="actualizarNombreSistema($event)" class="w-full" placeholder="SAKAI" />
                </div>
                <div class="form-group">
                    <label class="font-medium text-900 mb-2 block">Email Admin</label>
                    <input pInputText [(ngModel)]="emailAdmin" type="email" class="w-full" placeholder="admin@sistema.com" />
                </div>
                <div class="form-group">
                    <label class="font-medium text-900 mb-2 block">URL Base</label>
                    <input pInputText [(ngModel)]="urlBase" type="url" class="w-full" placeholder="https://misistema.com" />
                </div>
                <p-button label="Guardar" icon="pi pi-save" severity="success" (onClick)="guardar()"></p-button>
            </p-card>

            <!-- PERSONALIZACIN  -->
            <p-card class="mb-4">
                <ng-template pTemplate="header">
                    <div class="px-3 pt-3">
                        <h3 class="m-0 font-bold text-900"> Personalizaci贸n</h3>
                    </div>
                </ng-template>
                
                <div class="form-group">
                    <label class="font-medium text-900 mb-2 block">Color Principal del Sistema</label>
                    <div class="flex align-items-center gap-2">
                        <input 
                            type="color" 
                            [(ngModel)]="personalizacion.colorPrincipal" 
                            class="color-input"
                            style="width: 60px; height: 40px; border: 1px solid #ccc; border-radius: 6px; cursor: pointer;" />
                        <input 
                            pInputText 
                            [(ngModel)]="personalizacion.colorPrincipal" 
                            class="flex-1" 
                            placeholder="#3b82f6" />
                    </div>
                </div>

                <div class="form-group">
                    <label class="font-medium text-900 mb-2 block">Logo de la Empresa</label>
                    <input 
                        type="file" 
                        accept="image/png,image/jpg,image/jpeg" 
                        (change)="onLogoUpload($event)" 
                        class="w-full p-2 border-1 border-300 border-round"
                        style="font-size: 0.875rem;" />
                    <small class="text-500">M谩ximo 2MB. Formatos: PNG, JPG, JPEG</small>
                    
                    <!-- Preview del logo -->
                    <div *ngIf="personalizacion.logoEmpresa" class="mt-3">
                        <img [src]="personalizacion.logoEmpresa" alt="Logo" class="border-round" style="max-width: 150px; max-height: 100px; border: 1px solid #ddd; padding: 8px;" />
                    </div>
                </div>

                <div class="form-group">
                    <label class="font-medium text-900 mb-2 block">Tema</label>
                    <p-select 
                        [(ngModel)]="personalizacion.tema" 
                        [options]="opcionesTema"
                        optionLabel="label"
                        optionValue="value"
                        placeholder="Seleccionar tema"
                        class="w-full"></p-select>
                </div>

                <p-button 
                    label="Guardar Personalizaci贸n" 
                    icon="pi pi-save" 
                    severity="success"
                    (onClick)="guardarPersonalizacion()"></p-button>
            </p-card>


        </div>

        <!-- ==================== COLUMNA DERECHA ==================== -->
        <div class="col-12 lg:col-6">
            
            <!-- INFORMACIN DEL SISTEMA (ya existe) -->
            <p-card class="mb-4">
                <ng-template pTemplate="header">
                    <div class="px-3 pt-3">
                        <h3 class="m-0 font-bold text-900"> Informaci贸n del Sistema</h3>
                    </div>
                </ng-template>
                
                <div class="info-item">
                    <i class="pi pi-server" style="font-size: 2rem; color: #3b82f6;"></i>
                    <div>
                        <h3 class="text-500 font-medium mb-1">Versi贸n</h3>
                        <p class="text-900 font-bold text-xl m-0">1.0.0</p>
                    </div>
                </div>
                <div class="info-item">
                    <i class="pi pi-calendar" style="font-size: 2rem; color: #3b82f6;"></i>
                    <div>
                        <h3 class="text-500 font-medium mb-1">ltima Actualizaci贸n</h3>
                        <p class="text-900 font-bold text-xl m-0">01 de Febrero, 2026</p>
                    </div>
                </div>
                <div class="info-item">
                    <i class="pi pi-database" style="font-size: 2rem; color: #3b82f6;"></i>
                    <div>
                        <h3 class="text-500 font-medium mb-1">Base de Datos</h3>
                        <p class="text-900 font-bold text-xl m-0">PostgreSQL 14</p>
                    </div>
                </div>
                <div class="info-item">
                    <i class="pi pi-users" style="font-size: 2rem; color: #3b82f6;"></i>
                    <div>
                        <h3 class="text-500 font-medium mb-1">Usuarios Registrados</h3>
                        <p class="text-900 font-bold text-xl m-0">1,245</p>
                    </div>
                </div>
            </p-card>

            <!-- ...otros paneles existentes... -->

        </div>
    </div>
</div>

<!-- ==================== DIALOG DE PERMISOS ==================== -->
<p-dialog 
    header="Editar Permisos" 
    [(visible)]="mostrarDialogPermisos" 
    [modal]="true"
    [style]="{width: '500px'}"
    [closable]="true">
    
    <div *ngIf="rolSeleccionado">
        <h4 class="mb-3 text-900">Rol: <strong>{{ rolSeleccionado.nombre }}</strong></h4>
        
        <div class="flex flex-column gap-2">
            <div 
                *ngFor="let permiso of rolSeleccionado.permisos" 
                class="flex align-items-center gap-2 p-2 border-1 border-300 border-round">
                <input 
                    type="checkbox" 
                    [(ngModel)]="permiso.activo" 
                    [id]="'permiso-' + permiso.nombre" />
                <label 
                    [for]="'permiso-' + permiso.nombre" 
                    class="mb-0 cursor-pointer">
                    {{ permiso.nombre }}
                </label>
            </div>
        </div>
    </div>

    <ng-template pTemplate="footer">
        <p-button 
            label="Cancelar" 
            icon="pi pi-times" 
            severity="secondary"
            [outlined]="true"
            (onClick)="mostrarDialogPermisos = false"></p-button>
        <p-button 
            label="Guardar Permisos" 
            icon="pi pi-check" 
            severity="success"
            (onClick)="guardarPermisos()"></p-button>
    </ng-template>
</p-dialog>
