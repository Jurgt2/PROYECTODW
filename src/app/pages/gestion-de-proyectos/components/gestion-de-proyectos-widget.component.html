<div class="dashboard-container">
  <!-- ========== ENCABEZADO ========== -->
  <div class="surface-section px-0 py-5">
    <div class="flex align-items-start flex-column lg:justify-content-between lg:flex-row">
      <div>
        <div class="font-medium text-3xl text-900 mb-3"> Gesti贸n de Proyectos</div>
        <div class="text-500 mb-5">Administra y supervisa todos tus proyectos en un solo lugar</div>
      </div>
      <div class="mt-3 lg:mt-0">
        <button
          pButton
          label="Nuevo Proyecto"
          icon="pi pi-plus"
          class="p-button-success"
          (click)="abrirDialogNuevo()">
        </button>
      </div>
    </div>
  </div>

  <div class="content-section px-0">

    <!-- ========== TARJETAS DE ESTADSTICAS ========== -->
  <!-- ========== TARJETAS DE ESTADSTICAS ========== -->
<div class="grid mb-1" style="margin: 0; padding: 0;">
  
  <!-- Total Proyectos -->
  <div class="col-12 md:col-6 lg:col-150">
    <div class="card">
      <div class="mb-3">
        <span class="block text-500 font-medium mb-3">Total Proyectos</span>
        <div class="text-900 font-bold text-3xl">{{ stats.total }}</div>
      </div>
      <span class="text-blue-600 font-medium">Todos los proyectos</span>
    </div>
  </div>

  <!-- En Progreso -->
  <div class="col-12 md:col-6 lg:col-200">
    <div class="card">
      <div class="mb-3">
        <span class="block text-500 font-medium mb-3">En Progreso</span>
        <div class="text-900 font-bold text-3xl">{{ stats.activos }}</div>
      </div>
      <span class="text-blue-600 font-medium">Proyectos activos</span>
    </div>
  </div>

  <!-- Completados -->
  <div class="col-12 md:col-6 lg:col-250">
    <div class="card">
      <div class="mb-3">
        <span class="block text-500 font-medium mb-3">Completados</span>
        <div class="text-900 font-bold text-3xl">{{ stats.completados }}</div>
      </div>
      <span class="text-green-600 font-medium">Finalizados exitosamente</span>
    </div>
  </div>

  <!-- Miembros -->
  <div class="col-12 md:col-6 lg:col-300">
    <div class="card">
      <div class="mb-3">
        <span class="block text-500 font-medium mb-3">Miembros</span>
        <div class="text-900 font-bold text-3xl">{{ stats.totalMiembros }}</div>
      </div>
      <span class="text-yellow-600 font-medium">Total del equipo</span>
    </div>
  </div>

</div>
```



    <!-- ========== GRFICAS ========== -->
    <div class="grid mb-4 p-0">
      <div class="col-12 lg:col-6">
        <div class="card">
          <h3 class="text-900 font-medium mb-4"> Proyectos por Estado</h3>
          <div style="height: 300px">
            <p-chart type="doughnut" [data]="chartDataEstados" [options]="chartOptionsEstados"></p-chart>
          </div>
        </div>
      </div>

      <div class="col-12 lg:col-6">
        <div class="card">
          <h3 class="text-900 font-medium mb-4"> Gesti贸n de Presupuesto</h3>
          <div style="height: 300px">
            <p-chart type="bar" [data]="chartDataPresupuesto" [options]="chartOptionsPresupuesto"></p-chart>
          </div>
          <div class="mt-3 text-center">
            <span class="text-500">Utilizado: </span>
            <span class="text-900 font-bold">\${{ stats.presupuestoUtilizado.toLocaleString() }}</span>
            <span class="text-500"> de </span>
            <span class="text-900 font-bold">\${{ stats.presupuestoTotal.toLocaleString() }}</span>
          </div>
        </div>
      </div>
    </div>

    <!-- ========== FILTROS ========== -->
    <div class="card mb-4">
      <h3 class="text-900 font-medium mb-3"> Filtros</h3>
      <div class="grid">
        <div class="col-12 md:col-6 lg:col-3">
          <span class="p-input-icon-left w-full">
            <i class="pi pi-search"></i>
            <input
              pInputText
              type="text"
              [(ngModel)]="filtroTexto"
              (ngModelChange)="aplicarFiltros()"
              placeholder="Buscar proyecto..."
              class="w-full" />
          </span>
        </div>

        <div class="col-12 md:col-6 lg:col-3">
          <p-select
            [(ngModel)]="filtroEstado"
            [options]="opcionesEstado"
            optionLabel="label"
            optionValue="value"
            placeholder="Filtrar por estado"
            (onChange)="aplicarFiltros()"
            class="w-full">
          </p-select>
        </div>

        <div class="col-12 md:col-6 lg:col-3">
          <p-select
            [(ngModel)]="filtroPrioridad"
            [options]="opcionesPrioridad"
            optionLabel="label"
            optionValue="value"
            placeholder="Filtrar por prioridad"
            (onChange)="aplicarFiltros()"
            class="w-full">
          </p-select>
        </div>

        <div class="col-12 md:col-6 lg:col-3">
          <p-select
            [(ngModel)]="filtroDepartamento"
            [options]="opcionesDepartamento"
            optionLabel="label"
            optionValue="value"
            placeholder="Filtrar por departamento"
            (onChange)="aplicarFiltros()"
            class="w-full">
          </p-select>
        </div>
      </div>
    </div>

    <!-- ========== TABLA DE PROYECTOS ========== -->
    <div class="card">
      <h3 class="text-900 font-medium mb-3"> Lista de Proyectos</h3>
      
      <p-table
        [value]="proyectosFiltrados"
        [paginator]="true"
        [rows]="10"
        [showCurrentPageReport]="true"
        currentPageReportTemplate="Mostrando {first} a {last} de {totalRecords} proyectos"
        [rowsPerPageOptions]="[5, 10, 25, 50]"
        styleClass="p-datatable-sm">
        
        <ng-template pTemplate="header">
          <tr>
            <th>ID</th>
            <th>Proyecto</th>
            <th>Responsable</th>
            <th>Estado</th>
            <th>Prioridad</th>
            <th>Progreso</th>
            <th>Riesgos</th>
            <th>Fecha Fin</th>
            <th>Acciones</th>
          </tr>
        </ng-template>

        <ng-template pTemplate="body" let-proyecto>
          <tr>
            <td>
              <span class="font-bold text-sm">{{ proyecto.clave }}</span>
            </td>
            <td>
              <div>
                <div class="font-bold text-900 mb-1">{{ proyecto.nombre }}</div>
                <div class="text-500 text-sm">{{ proyecto.departamento }}</div>
              </div>
            </td>
            <td>{{ proyecto.responsable }}</td>
            <td>
              <p-tag
                [value]="proyecto.estado"
                [severity]="getSeverityEstado(proyecto.estado)">
              </p-tag>
            </td>
            <td>
              <p-tag
                [value]="proyecto.prioridad"
                [severity]="getSeverityPrioridad(proyecto.prioridad)">
              </p-tag>
            </td>
            <td>
              <div class="flex align-items-center">
                <span class="mr-2 font-medium">{{ proyecto.progreso }}%</span>
                <p-progressBar
                  [value]="proyecto.progreso"
                  [showValue]="false"
                  [style]="{'height': '8px', 'width': '100px'}"
                  [styleClass]="'custom-progressbar'">
                </p-progressBar>
              </div>
            </td>
            <td>
              <button
                *ngIf="proyecto.riesgosAsociados > 0"
                pButton
                [label]="proyecto.riesgosAsociados.toString()"
                icon="pi pi-exclamation-triangle"
                class="p-button-rounded p-button-warning p-button-sm"
                pTooltip="Ver riesgos asociados"
                (click)="verRiesgos(proyecto)">
              </button>
              <span *ngIf="proyecto.riesgosAsociados === 0" class="text-500">Sin riesgos</span>
            </td>
            <td>{{ proyecto.fechaFin | date:'dd/MM/yyyy' }}</td>
            <td>
              <div class="flex gap-2">
                <button
                  pButton
                  icon="pi pi-eye"
                  class="p-button-rounded p-button-info p-button-sm"
                  pTooltip="Ver detalles"
                  (click)="verDetalle(proyecto)">
                </button>
                <button
                  pButton
                  icon="pi pi-pencil"
                  class="p-button-rounded p-button-success p-button-sm"
                  pTooltip="Editar"
                  (click)="editarProyecto(proyecto)">
                </button>
                <button
                  pButton
                  icon="pi pi-trash"
                  class="p-button-rounded p-button-danger p-button-sm"
                  pTooltip="Eliminar"
                  (click)="eliminarProyecto(proyecto.id)">
                </button>
              </div>
            </td>
          </tr>
        </ng-template>

        <ng-template pTemplate="emptymessage">
          <tr>
            <td colspan="9" class="text-center py-5">
              <i class="pi pi-inbox text-4xl text-400 mb-3"></i>
              <p class="text-500">No se encontraron proyectos</p>
            </td>
          </tr>
        </ng-template>
      </p-table>
    </div>

  </div>
</div>

<!-- ========== DIALOG DETALLES ========== -->
<p-dialog
  [(visible)]="mostrarDialogDetalles"
  [header]="'Detalles del Proyecto: ' + (proyectoSeleccionado?.nombre || '')"
  [modal]="true"
  [style]="{width: '800px'}"
  [draggable]="false"
  [resizable]="false">
  
  <div *ngIf="proyectoSeleccionado">
    <div class="grid">
      <div class="col-12 md:col-6">
        <div class="mb-3">
          <label class="font-bold text-900 block mb-2">Clave del Proyecto:</label>
          <span>{{ proyectoSeleccionado.clave }}</span>
        </div>
      </div>
      
      <div class="col-12 md:col-6">
        <div class="mb-3">
          <label class="font-bold text-900 block mb-2">Responsable:</label>
          <span>{{ proyectoSeleccionado.responsable }}</span>
        </div>
      </div>

      <div class="col-12">
        <div class="mb-3">
          <label class="font-bold text-900 block mb-2">Descripci贸n:</label>
          <p class="text-600">{{ proyectoSeleccionado.descripcion }}</p>
        </div>
      </div>

      <div class="col-12 md:col-4">
        <div class="mb-3">
          <label class="font-bold text-900 block mb-2">Estado:</label>
          <p-tag
            [value]="proyectoSeleccionado.estado"
            [severity]="getSeverityEstado(proyectoSeleccionado.estado)">
          </p-tag>
        </div>
      </div>

      <div class="col-12 md:col-4">
        <div class="mb-3">
          <label class="font-bold text-900 block mb-2">Prioridad:</label>
          <p-tag
            [value]="proyectoSeleccionado.prioridad"
            [severity]="getSeverityPrioridad(proyectoSeleccionado.prioridad)">
          </p-tag>
        </div>
      </div>

      <div class="col-12 md:col-4">
        <div class="mb-3">
          <label class="font-bold text-900 block mb-2">Departamento:</label>
          <span>{{ proyectoSeleccionado.departamento }}</span>
        </div>
      </div>

      <div class="col-12 md:col-6">
        <div class="mb-3">
          <label class="font-bold text-900 block mb-2">Fecha Inicio:</label>
          <span>{{ proyectoSeleccionado.fechaInicio | date:'dd/MM/yyyy' }}</span>
        </div>
      </div>

      <div class="col-12 md:col-6">
        <div class="mb-3">
          <label class="font-bold text-900 block mb-2">Fecha Fin:</label>
          <span>{{ proyectoSeleccionado.fechaFin | date:'dd/MM/yyyy' }}</span>
        </div>
      </div>

      <div class="col-12">
        <div class="mb-3">
          <label class="font-bold text-900 block mb-2">Progreso: {{ proyectoSeleccionado.progreso }}%</label>
          <p-progressBar
            [value]="proyectoSeleccionado.progreso"
            [showValue]="true">
          </p-progressBar>
        </div>
      </div>

      <div class="col-12 md:col-6">
        <div class="mb-3">
          <label class="font-bold text-900 block mb-2">Presupuesto Total:</label>
          <span class="text-xl font-bold text-blue-600">\${{ proyectoSeleccionado.presupuesto.toLocaleString() }}</span>
        </div>
      </div>

      <div class="col-12 md:col-6">
        <div class="mb-3">
          <label class="font-bold text-900 block mb-2">Presupuesto Utilizado:</label>
          <span class="text-xl font-bold text-green-600">\${{ proyectoSeleccionado.presupuestoUtilizado.toLocaleString() }}</span>
        </div>
      </div>

      <div class="col-12">
        <div class="mb-3">
          <label class="font-bold text-900 block mb-2">Miembros del Equipo:</label>
          <div class="flex flex-wrap gap-2">
            <p-tag *ngFor="let miembro of proyectoSeleccionado.miembrosEquipo" [value]="miembro" severity="info"></p-tag>
          </div>
        </div>
      </div>

      <div class="col-12">
        <div class="mb-3">
          <label class="font-bold text-900 block mb-2">Riesgos Asociados:</label>
          <span class="text-xl font-bold" [class]="proyectoSeleccionado.riesgosAsociados > 0 ? 'text-red-600' : 'text-green-600'">
            {{ proyectoSeleccionado.riesgosAsociados }}
          </span>
        </div>
      </div>

      <div class="col-12" *ngIf="proyectoSeleccionado.notas">
        <div class="mb-3">
          <label class="font-bold text-900 block mb-2">Notas:</label>
          <p class="text-600 bg-gray-50 p-3 border-round">{{ proyectoSeleccionado.notas }}</p>
        </div>
      </div>

      <div class="col-12">
        <div class="mb-3">
          <label class="font-bold text-900 block mb-2">Historial:</label>
          <div class="timeline-container">
            <div *ngFor="let item of proyectoSeleccionado.historial" class="timeline-item">
              <div class="timeline-badge">
                <i class="pi pi-circle-fill text-xs"></i>
              </div>
              <div class="timeline-content">
                <div class="font-bold text-900">{{ item.accion }}</div>
                <div class="text-500 text-sm mb-1">{{ item.fecha | date:'dd/MM/yyyy HH:mm' }} - {{ item.usuario }}</div>
                <p class="text-600 text-sm m-0">{{ item.detalle }}</p>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <ng-template pTemplate="footer">
    <button pButton label="Cerrar" icon="pi pi-times" class="p-button-text" (click)="mostrarDialogDetalles = false"></button>
  </ng-template>
</p-dialog>

<!-- ========== DIALOG NUEVO/EDITAR PROYECTO ========== -->
<p-dialog
  [(visible)]="mostrarDialogNuevo"
  [header]="nuevoProyecto.id ? 'Editar Proyecto' : 'Nuevo Proyecto'"
  [modal]="true"
  [style]="{width: '650px', maxHeight: '90vh'}"
  [draggable]="false"
  [resizable]="false"
  [contentStyle]="{'padding': '0'}">
  
  <div class="p-4">
    <!-- Secci贸n: Informaci贸n General -->
    <div class="mb-4">
      <div class="surface-100 p-2 border-round mb-3">
        <h3 class="text-900 font-semibold mt-0 mb-0 text-center"> Informaci贸n General</h3>
      </div>

      <div class="mb-3">
        <label for="nombre" class="font-bold text-900 block mb-2">Nombre del Proyecto *</label>
        <input pInputText id="nombre" [(ngModel)]="nuevoProyecto.nombre" class="w-full" placeholder="Ej: Sistema de Gesti贸n de Riesgos" />
      </div>

      <div class="mb-3">
        <label for="clave" class="font-bold text-900 block mb-2">Clave del Proyecto *</label>
        <input pInputText id="clave" [(ngModel)]="nuevoProyecto.clave" class="w-full" placeholder="Ej: PROJ-001" />
      </div>

      <div class="mb-3">
        <label for="descripcion" class="font-bold text-900 block mb-2">Descripci贸n</label>
        <textarea pInputText id="descripcion" [(ngModel)]="nuevoProyecto.descripcion" rows="2" class="w-full" placeholder="Descripci贸n breve del proyecto y sus objetivos"></textarea>
      </div>
    </div>

    <!-- Secci贸n: Responsables y Clasificaci贸n -->
    <div class="mb-4">
      <div class="surface-100 p-2 border-round mb-3">
        <h3 class="text-900 font-semibold mt-0 mb-0 text-center"> Responsables y Clasificaci贸n</h3>
      </div>

      <div class="mb-3">
        <label for="responsable" class="font-bold text-900 block mb-2">Responsable del Proyecto *</label>
        <input pInputText id="responsable" [(ngModel)]="nuevoProyecto.responsable" class="w-full" placeholder="Ej: Ana Garc铆a" />
      </div>

      <div class="mb-3">
        <label for="departamento" class="font-bold text-900 block mb-2">Departamento *</label>
        <p-select
          [(ngModel)]="nuevoProyecto.departamento"
          [options]="opcionesDepartamento"
          optionLabel="label"
          optionValue="value"
          placeholder="Seleccionar departamento"
          class="w-full">
        </p-select>
      </div>

      <div class="mb-3">
        <label for="estado" class="font-bold text-900 block mb-2">Estado del Proyecto *</label>
        <p-select
          [(ngModel)]="nuevoProyecto.estado"
          [options]="opcionesEstado.slice(1)"
          optionLabel="label"
          optionValue="value"
          placeholder="Seleccionar estado"
          class="w-full">
        </p-select>
      </div>

      <div class="mb-3">
        <label for="prioridad" class="font-bold text-900 block mb-2">Prioridad del Proyecto *</label>
        <p-select
          [(ngModel)]="nuevoProyecto.prioridad"
          [options]="opcionesPrioridad.slice(1)"
          optionLabel="label"
          optionValue="value"
          placeholder="Seleccionar prioridad"
          class="w-full">
        </p-select>
      </div>

      <div class="mb-3">
        <label for="progreso" class="font-bold text-900 block mb-2">Progreso del Proyecto (%)</label>
        <input pInputText type="number" id="progreso" [(ngModel)]="nuevoProyecto.progreso" min="0" max="100" class="w-full" placeholder="0" />
      </div>
    </div>

    <!-- Secci贸n: Fechas y Cronograma -->
    <div class="mb-4">
      <div class="surface-100 p-2 border-round mb-3">
        <h3 class="text-900 font-semibold mt-0 mb-0 text-center"> Fechas y Cronograma</h3>
      </div>

      <div class="mb-3">
        <label for="fechaInicio" class="font-bold text-900 block mb-2">Fecha de Inicio *</label>
        <input pInputText type="date" id="fechaInicio" [(ngModel)]="nuevoProyecto.fechaInicio" class="w-full" />
      </div>

      <div class="mb-3">
        <label for="fechaFin" class="font-bold text-900 block mb-2">Fecha de Finalizaci贸n *</label>
        <input pInputText type="date" id="fechaFin" [(ngModel)]="nuevoProyecto.fechaFin" class="w-full" />
      </div>
    </div>

    <!-- Secci贸n: Presupuesto -->
    <div class="mb-4">
      <div class="surface-100 p-2 border-round mb-3">
        <h3 class="text-900 font-semibold mt-0 mb-0 text-center"> Presupuesto</h3>
      </div>

      <div class="mb-3">
        <label for="presupuesto" class="font-bold text-900 block mb-2">Presupuesto Total *</label>
        <span class="p-input-icon-left w-full">
          <i class="pi pi-dollar"></i>
          <input pInputText type="number" id="presupuesto" [(ngModel)]="nuevoProyecto.presupuesto" class="w-full" placeholder="100000" />
        </span>
      </div>

      <div class="mb-3">
        <label for="presupuestoUtilizado" class="font-bold text-900 block mb-2">Presupuesto Utilizado</label>
        <span class="p-input-icon-left w-full">
          <i class="pi pi-dollar"></i>
          <input pInputText type="number" id="presupuestoUtilizado" [(ngModel)]="nuevoProyecto.presupuestoUtilizado" class="w-full" placeholder="0" />
        </span>
      </div>
    </div>

    <!-- Secci贸n: Notas Adicionales -->
    <div class="mb-2">
      <div class="surface-100 p-2 border-round mb-3">
        <h3 class="text-900 font-semibold mt-0 mb-0 text-center"> Notas Adicionales</h3>
      </div>

      <div class="mb-2">
        <label for="notas" class="font-bold text-900 block mb-2">Notas</label>
        <textarea pInputText id="notas" [(ngModel)]="nuevoProyecto.notas" rows="3" class="w-full" placeholder="Agrega notas, comentarios o informaci贸n adicional del proyecto..."></textarea>
      </div>
    </div>
  </div>

  <ng-template pTemplate="footer">
    <div class="flex gap-2 justify-content-end">
      <button pButton label="Cancelar" icon="pi pi-times" class="p-button-text p-button-secondary" (click)="mostrarDialogNuevo = false"></button>
      <button
        pButton
        [label]="nuevoProyecto.id ? 'Actualizar Proyecto' : 'Crear Proyecto'"
        [icon]="nuevoProyecto.id ? 'pi pi-save' : 'pi pi-plus'"
        class="p-button-success"
        (click)="nuevoProyecto.id ? actualizarProyecto() : guardarNuevoProyecto()">
      </button>
    </div>
  </ng-template>
</p-dialog>